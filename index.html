<!DOCTYPE html>
<html>
<head>
  <title>Ripley Rally Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="intro">
  <h1>ğŸ‰ Welcome to the Ripley Rally ğŸ‰</h1>
  <p>Unscramble this anagram to reveal todayâ€™s destination:</p>
  <p><b>WALTON ON THEM SA</b></p>
  <input id="anagram" placeholder="Enter destination">
  <button onclick="checkAnagram()">Submit</button>
</div>

<div id="team" class="hidden">
  <h2>Destination unlocked: Walton-on-Thames!</h2>
  <p>Enter your team name:</p>
  <input id="teamName">
  <button onclick="startQuiz()">Start Quiz</button>
</div>

<div id="quiz" class="hidden">
  <div class="timer">Time left: <span id="time">300</span> seconds</div>
  <div id="questionBox"></div>
</div>

<div id="results" class="hidden">
  <h2>ğŸ‰ Quiz Complete! ğŸ‰</h2>
  <p id="score"></p>
  <button onclick="saveScore()">Save to Leaderboard</button>
  <button onclick="showLeaderboard()">View Leaderboard</button>
</div>

<div id="leaderboard" class="hidden">
  <h2>ğŸ† Leaderboard ğŸ†</h2>
  <ul id="board"></ul>
</div>

<script src="questions.js?v=2"></script>
<script>
window.onload = function() {

  let current = 0, score = 0, team = "";
  let timer = 300; // 5 minutes

  function checkAnagram(){
    let ans = document.getElementById("anagram").value.toLowerCase();
    if(ans.includes("walton-on-thames")){
      document.getElementById("intro").classList.add("hidden");
      document.getElementById("team").classList.remove("hidden");
    } else { alert("Try again!"); }
  }

  function startQuiz(){
    team = document.getElementById("teamName").value;
    document.getElementById("team").classList.add("hidden");
    document.getElementById("quiz").classList.remove("hidden");
    showQuestion();
    setInterval(()=>{ 
      if(timer>0){ 
        timer--; 
        document.getElementById("time").innerText = timer; 
      }
      else { endQuiz(); }
    },1000);
  }

  function showQuestion(){
    if(current >= questions.length){ 
      endQuiz(); 
      return; 
    }

    let q = questions[current];

    let html = `<div class='question'><h3>${q.q}</h3>`;
    q.options.forEach((opt,i)=>{
      html += `<button onclick='answer(${i})'>${opt}</button><br>`;
    });
    html += `</div>`;

    document.getElementById("questionBox").innerHTML = html;
  }

  function answer(i){
    if(i === questions[current].answer){ 
      score++; 
    }
    current++;
    showQuestion();
  }

  function endQuiz(){
    document.getElementById("quiz").classList.add("hidden");
    document.getElementById("results").classList.remove("hidden");
    document.getElementById("score").innerText = 
      `Team: ${team} | Score: ${score}`;
  }

  function saveScore(){
    let board = JSON.parse(localStorage.getItem("ripleyBoard") || "[]");
    board.push({team:team, score:score});
    localStorage.setItem("ripleyBoard", JSON.stringify(board));
    alert("Score saved!");
  }

  function showLeaderboard(){
    document.getElementById("results").classList.add("hidden");
    document.getElementById("leaderboard").classList.remove("hidden");
    let board = JSON.parse(localStorage.getItem("ripleyBoard") || "[]");
    board.sort((a,b)=>b.score - a.score);
    document.getElementById("board").innerHTML = board
      .map(e => `<li>${e.team}: ${e.score}</li>`)
      .join("");
  }

  // Expose functions to HTML buttons
  window.checkAnagram = checkAnagram;
  window.startQuiz = startQuiz;
  window.saveScore = saveScore;
  window.showLeaderboard = showLeaderboard;

}; // END window.onload
</script>

</body>
</html>
